<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Interseção à Vante – Topografia</title>

  <!-- React via CDN -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      padding: 20px;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 700px;
      margin: auto;
      box-shadow: 0 2px 8px rgba(0,0,0,.1);
    }
    input {
      width: 100%;
      padding: 6px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px;
      width: 100%;
      font-weight: bold;
      cursor: pointer;
    }
    .resultado {
      margin-top: 20px;
      background: #eef2f7;
      padding: 15px;
      border-radius: 6px;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    function IntersecaoVanteRelatorio() {
      const [dados, setDados] = React.useState({
        xA: "", yA: "",
        xB: "", yB: "",
        dhAP: "", dhBP: ""
      });

      const [resultado, setResultado] = React.useState(null);

      const handleChange = e => {
        setDados({ ...dados, [e.target.name]: e.target.value });
      };

      const calcular = () => {
        const xA = parseFloat(dados.xA);
        const yA = parseFloat(dados.yA);
        const xB = parseFloat(dados.xB);
        const yB = parseFloat(dados.yB);
        const dhAP = parseFloat(dados.dhAP);
        const dhBP = parseFloat(dados.dhBP);

        if ([xA,yA,xB,yB,dhAP,dhBP].some(isNaN)) {
          alert("Preencha todos os campos corretamente.");
          return;
        }

        const dX = xB - xA;
        const dY = yB - yA;

        let azAB = Math.atan2(dX, dY) * 180 / Math.PI;
        if (azAB < 0) azAB += 360;

        let azAP = azAB + dhAP;
        if (azAP >= 360) azAP -= 360;

        let azBA = azAB + 180;
        if (azBA >= 360) azBA -= 360;

        let azBP = azBA + dhBP;
        if (azBP >= 360) azBP -= 360;

        const azAPr = azAP * Math.PI / 180;
        const azBPr = azBP * Math.PI / 180;

        const senA = Math.sin(azAPr);
        const cosA = Math.cos(azAPr);
        const senB = Math.sin(azBPr);
        const cosB = Math.cos(azBPr);

        const denom = senA * cosB - cosA * senB;
        if (Math.abs(denom) < 1e-10) {
          alert("Direções quase paralelas.");
          return;
        }

        const t = ((xB - xA) * cosB - (yB - yA) * senB) / denom;

        const xP = xA + t * senA;
        const yP = yA + t * cosA;

        // Resíduos (erro topográfico real)
        const aA = cosA, bA = -senA, cA = -(aA*xA + bA*yA);
        const aB = cosB, bB = -senB, cB = -(aB*xB + bB*yB);

        const rA = Math.abs(aA*xP + bA*yP + cA) / Math.sqrt(aA*aA + bA*bA);
        const rB = Math.abs(aB*xP + bB*yP + cB) / Math.sqrt(aB*aB + bB*bB);

        const erro = Math.sqrt(rA*rA + rB*rB);

        setResultado({
          azAB, azAP, azBP,
          xP, yP,
          rA, rB,
          erro
        });
      };

      return (
        <div className="card">
          <h2>Interseção à Vante</h2>

          <input name="xA" placeholder="XA" onChange={handleChange} />
          <input name="yA" placeholder="YA" onChange={handleChange} />
          <input name="xB" placeholder="XB" onChange={handleChange} />
          <input name="yB" placeholder="YB" onChange={handleChange} />
          <input name="dhAP" placeholder="ΔHz A→P (graus)" onChange={handleChange} />
          <input name="dhBP" placeholder="ΔHz B→P (graus)" onChange={handleChange} />

          <button onClick={calcular}>Calcular</button>

          {resultado && (
            <div className="resultado">
              <p><b>XP:</b> {resultado.xP.toFixed(3)}</p>
              <p><b>YP:</b> {resultado.yP.toFixed(3)}</p>
              <p><b>Resíduo A:</b> {resultado.rA.toFixed(4)} m</p>
              <p><b>Resíduo B:</b> {resultado.rB.toFixed(4)} m</p>
              <p><b>Erro Linear:</b> {resultado.erro.toFixed(4)} m</p>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root"))
      .render(<IntersecaoVanteRelatorio />);
  </script>
</body>
</html>
